<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>Mongodb文档的CURD操作 | gishub.info-where to collect gis info</title>
    <meta name="author" content="suwenjiang">
    
    <meta name="description" content="gis 知识的集散地">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="Mongodb文档的CURD操作"/>
    <meta property="og:site_name" content="suwen&#39;s GISHub"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="suwen&#39;s GISHub" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="indigo">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">suwen&#39;s GISHub</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav indigo darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://ww2.sinaimg.cn/small/74990035jw1f1rjkd681bj20rs0rsdhg.jpg" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">你的大名</p>
                        <p class="desc">Web前端/iOS/技术宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav indigo darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Reading-Notes/">
                    Reading-Notes <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/arcgis-server/">
                    arcgis-server <span class="right">6 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/coding/">
                    coding <span class="right">3 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/opensource/">
                    opensource <span class="right">4 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-1" collapse-level="1">
                <a class="no-padding" href="/categories/opensource/database/">
                    database <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper indigo">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/opensource/">opensource</a><a class="breadcrumb" href="/categories/opensource/database/">database</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>Mongodb文档的CURD操作</h1>
    


            </div>
            <time class="pink-link-context" datetime="2016-06-14T08:38:38.000Z"><a href="/2016/06/14/mongodb-CURD/">2016-06-14</a></time>

            
    <div class="tags-row">
        
            <a href="/tags/CURD/" class="chip pink lighten-1">CURD</a>
        
            <a href="/tags/database/" class="chip pink lighten-1">database</a>
        
            <a href="/tags/mongodb/" class="chip pink lighten-1">mongodb</a>
        
            <a href="/tags/opensource/" class="chip pink lighten-1">opensource</a>
        
    </div>


            <div class="toc pink-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#插入document"><span class="section table-of-contents-text">插入document</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#查询document"><span class="section table-of-contents-text">查询document</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#update"><span class="section table-of-contents-text">update</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#delete操作"><span class="section table-of-contents-text">delete操作</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#总结"><span class="section table-of-contents-text">总结</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#更多参考"><span class="section table-of-contents-text">更多参考</span></a></li></ol>
</div>


            <div class="entry pink-link-context">
                <p>从当年写毕业论文学习如何使用mongodb，到现在陆陆续续的在使用。一直都没有系统的去看看mongodb的文档。由于moogoose的原因，最近又在操作<br>mongodb，想想磨刀不误砍柴工，看看文档，动动笔记录记录。</p>
<p>在mongodb中有db，collection，document数据模型，今天先来说说mongodb的基元document的操作。mongodb所有的操作都围绕document来做。<strong>document相当于<br>传统关系型数据库中的row</strong></p>
<a id="more"></a>
<h2 id="插入document">插入document</h2><p>类似关系型数据库，一条条的row插入到table中，而NoSql中的一个个document 插入到collection中。</p>
<p>插入document的语句有如下几种：</p>
<ol>
<li><code>db.collection_name.insert()</code></li>
<li><code>db.collection_name.insertOne()</code></li>
<li><code>db.collection_name.insertMany()</code></li>
</ol>
<p>通过字面意思也知道这几种插入方法的不同。其中1既可以插入一个document，也可以插入多个。而2,3是后续版本中添加的。mongodb的所有的写操作都是<strong>原子（atomic）</strong>。</p>
<p>mongodb的document都包含一个 <strong>_id</strong> 字段，该字段类似于关系型数据库中的<strong>primary<br>key</strong>。其中_id可以在插入文档候自定义赋值，如<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.some_col.insert(&#123;<span class="string">"_id"</span>:<span class="number">6</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">'suwen'</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
<p>也可以不显示指明，如果没有显示指明则mongodb会根据时间戳+pid+随机数信息生成一个类型为objectid的_id 值。如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.some_col.insert(&#123;<span class="string">"name"</span>:<span class="string">'suwen'</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>通过查询，其_id值为5750f3b164cfe92c28a4c2b1。且mongodb含有从 _id中提取时时间戳信息的命令。</p>
<h2 id="查询document">查询document</h2><p>在mongo中document的查询语句如下：</p>
<ol>
<li><code>db.collection.find(&lt;query&gt;,&lt;projection&gt;)</code></li>
<li><code>db.collection.findOne(&lt;query&gt;,&lt;projection&gt;)</code></li>
</ol>
<p>其中query为查询语句，而为optional参数对查询返回的<strong>字段</strong>进行过滤。可以控制查询结果的传输量。</p>
<p>其中findOne可以直接获取一个document，而find获取多个document。则在获取document的中的某个字段值的时候需要注意。如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dd=db.testpoint.findOne(&#123;name:<span class="string">"id1"</span>&#125;)</span><br><span class="line">dd.name <span class="comment">// id1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dd=db.testpoint.find(&#123;name:<span class="string">"id1"</span>&#125;)</span><br><span class="line"></span><br><span class="line">dd.name <span class="comment">//no result to show</span></span><br><span class="line">dd[<span class="number">0</span>].name <span class="comment">//id1</span></span><br></pre></td></tr></table></figure>
<p><strong>当find()不添加任何参数或者参数为{}的时候，表示查询当前collection中的所有document。</strong></p>
<ul>
<li>project</li>
</ul>
<p>project格式如下：{field1：,field2:..}其中字段值只有<strong>0和1两类</strong>。其中0表示字段排除，1表示字段包含。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.testpoint.findOne(&#123;name:&#34;id1&#34;&#125;,&#123;_id:0&#125;) //&#26597;&#35810;&#32467;&#26524;&#19981;&#21253;&#21547;_id &#20449;&#24687;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>query</li>
</ul>
<p>mongo提供了非常丰富的query，来应用不同场景的查询。</p>
<p>大体分为下面几类：</p>
<p>1.简单相等查询</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.some_col.find(&#123;&#34;name&#34;:&#34;suwen&#34;&#125;)</span><br></pre></td></tr></table></figure>
<p>AND条件查询,直接多个字段<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.some_col.find(&#123;&#34;name&#34;:&#34;suwen&#34;,&#39;gender&#39;:&#39;male&#39;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>其他的OR条件或者比较查询需要与操作符进搭配使用。</p>
<p>2.与操作符结合判断</p>
<p>mongod提供了一些犹如关系型数据库中的操作符$in,$lt等。如<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.some_col.find(&#123;<span class="string">"name"</span>:&#123;$<span class="keyword">in</span>:[<span class="string">"suwen,mb"</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>用法和关系型数据库的in操作符一样。后面会专门写篇文章来学习这些关键字。</p>
<p>3.嵌套和引用文档的查询<br>mongodb 通过嵌套和应用构建复杂的document，这两者怎么查询呢？</p>
<p>有如下document：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">db.users.insert([&#123;</span><br><span class="line">    username: <span class="string">'suwen'</span>,</span><br><span class="line">    contact: &#123; <span class="comment">//嵌套document</span></span><br><span class="line">        phone: <span class="string">'111111111'</span>,</span><br><span class="line">        email: <span class="string">'1111@qq.com'</span>&#125;,</span><br><span class="line">    department: &#123; <span class="comment">//嵌套document</span></span><br><span class="line">        level: <span class="number">0</span>,</span><br><span class="line">        title: <span class="string">"giser"</span>&#125;,</span><br><span class="line">    </span><br><span class="line">    hobby: [<span class="string">'eating'</span>,<span class="string">'sleeping'</span>,<span class="string">'hit doudou'</span>] <span class="comment">//Array</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    username: <span class="string">'jmb'</span>,</span><br><span class="line">    contact: &#123; <span class="comment">//嵌套document</span></span><br><span class="line">        phone: <span class="string">'222222222'</span>,</span><br><span class="line">        email: <span class="string">'2222@qq.com'</span>&#125;,</span><br><span class="line">    department: &#123; <span class="comment">//嵌套document</span></span><br><span class="line">        level: <span class="number">0</span>,</span><br><span class="line">        title: <span class="string">"loser"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    hobby: [<span class="string">'sleeping'</span>,<span class="string">'eating'</span>] <span class="comment">//Array</span></span><br><span class="line">&#125;])</span><br></pre></td></tr></table></figure></p>
<p>嵌套document的查询有两种方式：</p>
<p>一是<strong>文档完全匹配的形式</strong></p>
<p>如find上面的记录需要使用如下语句：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(</span><br><span class="line">&#123;</span><br><span class="line"> contact: &#123; </span><br><span class="line">        phone: <span class="string">'111111111'</span>,</span><br><span class="line">        email: <span class="string">'1111@qq.com'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>那么如果我只想以电话作为条件是不是可以使用如下这种形式？？？？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(</span><br><span class="line">&#123;</span><br><span class="line"> contact: &#123; </span><br><span class="line">        phone: <span class="string">'111111111'</span></span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;) <span class="comment">//no results</span></span><br></pre></td></tr></table></figure></p>
<p>执行完，发现并没有结果出现。。这也是为何这种方式叫文档完全匹配。如果只使用嵌套文档中的某个字段作为条件来过滤，则需要使用如下第二种方式：</p>
<p>二是<strong>通过dot notation的形式</strong>，该形式的格式为<code>&lt;document&gt;.&lt;field&gt;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(</span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">'contact.phone'</span>:<span class="string">'111111111'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>4.Array的查询</p>
<p>有了上面几个基础，再来理解Array的查询就容易多了。 document的字段值可能是一个Array类型。如何对Array的值进行判断，从而来筛选document呢？</p>
<p>一是完全匹配形式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123; hobby: [<span class="string">'eating'</span>,<span class="string">'sleeping'</span>,<span class="string">'hit doudou'</span>]&#125;)</span><br></pre></td></tr></table></figure></p>
<p>同样其为整个Array的匹配。只有全部匹配的Array才能筛选出。</p>
<p>二是匹配Array中的某个元素<br>针对Array中的某个元素的匹配，可以使用犹如普通的筛选语句。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123; hobby: &#39;hit doudou&#39;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>除此之外，array还有一种常见方式<br>三对Array某个位置的元素进行匹配<br>如对array的index的value为’eating’的进行匹配。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123; &#34;hobby.0&#34;: &#39;eating&#39;&#125;)</span><br></pre></td></tr></table></figure>
<p>Array除此上面三种方式，还有更为复杂条件匹配。此处按下不表。</p>
<h2 id="update">update</h2><p>这个就厉害了。</p>
<ol>
<li><code>db.collection.update()</code></li>
<li><code>db.collection.updateOne()</code></li>
<li><code>db.collection.updateMany()</code></li>
<li><code>db.collection.replaceOne()</code></li>
</ol>
<p>其中<code>upate(&lt;query&gt;,&lt;update&gt;,&lt;upsert&gt;,&lt;multi&gt;,&lt;writeConcern&gt;)</code>方法用来<code>更新或者替代</code>匹配的文档。其中前两个参数为必填参数。</p>
<p>query为匹配的条件filter，update为更新的内容，<code>upsert</code>这个参数厉害了，当通过query查找没有匹配的document的且upsert参数为true，这个时候，将会在collection中去insert一条document。而multi指定是否同时更新多个document。</p>
<p>前面说到update()用来更新或者替换，那么问题来了，什么时候是对document的更新，什么是替换整个document。</p>
<blockquote>
<p>当upate的document中有update操作符如$set,$unset才为更新操作，否则用该document替换匹配的document</p>
</blockquote>
<p>细思极恐啊。万一这要是弄混淆了。。。不知道mongodb怎么会这么设计。我想这也是为何在后续版本中，将update()方法拆分几个方法的原因。</p>
<h2 id="delete操作">delete操作</h2><p>删除操作有如下几个语句</p>
<ol>
<li><code>db.collection.remove()</code></li>
<li><code>db.collection.deleteOne()</code></li>
<li><code>db.collection.deleteMany()</code></li>
</ol>
<p>用法类似，语法如：<code>revmove(&lt;query&gt;,&lt;justone&gt;,&lt;writeConcern&gt;)</code>。其中query为匹配的条件，其和查询中的条件格式一<br>样。默认情况下，remove对所有匹配的记录进行删除，但是通过将参数<code>justone</code>设置为true，则只删除匹配记录中的一条记录。那么问题来了，如果匹配多<br>个记录该删除那条呢？此时官方文档狡猾的推荐使用<code>db.collection.findAndDelete()</code>。可以对查询的结果按照条件排序，然后再删除第一条记录。</p>
<h2 id="总结">总结</h2><p>mongodb在版本迭代的过程中，一个操作有多个方式实现。个人觉着还是使用更为精细的控制，比如插入用insertOne或者insertMany。避免造成不必要的误操作。</p>
<h2 id="更多参考">更多参考</h2><p><a href="https://docs.mongodb.com/manual/crud/" target="_blank" rel="external">MongoDB CRUD Operations</a></p>

            </div>
        </div>
    </div>
</article>




    <section id="comment">
        <div class="card">
            <div class="card-content">
                <!-- Duoshuo Comment BEGIN -->
                <div class="ds-thread" data-thread-key="2016/06/14/mongodb-CURD/" data-title="Mongodb文档的CURD操作" data-url="gishub.info/2016/06/14/mongodb-CURD/"></div>

                <script type="text/javascript">
                    console.log(document.querySelector('.ds-thread'));
                    var duoshuoQuery = {
                        short_name: 'myyouthlife'
                    };
                    (function() {
                        var ds = document.createElement('script');
                        ds.type = 'text/javascript';
                        ds.async = true;
                        ds.src = (document.location.protocol == 'https:'
                            ? 'https:'
                            : 'http:') + '//static.duoshuo.com/embed.js';
                        ds.charset = 'UTF-8';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                    })();
                </script>
                <!-- Duoshuo Comment END -->
            </div>
        </div>
    </section>



</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large pink">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect green" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse yellow darken-1"  data-activates="main-menu" title="menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer indigo darken-1">
    
    <div class="container">
        <div class="row">
            
            <div class="social-group col m3 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/suwenjiang" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/myyouthlife" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
            </div>
            

            
            <div class="col m9 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://zhihu.esrichina.com.cn/" target="_blank">ArcGIS知乎</a>
                
                    <a class="social-link" href="http://kikitamap.com/" target="_blank">kikita&amp;Maps</a>
                
                    <a class="social-link" href="http://oopsliu.github.io/" target="_blank">oopsliu</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright pink-link-context">
        <div class="container">
            © 2016 gishub.info, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();
            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('pink lighten-2');

            
            // 添加new标签
            $('.menu-reading, .menu-about').append('<span class="new badge pink"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "sitemap.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword pink lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script type="text/javascript" async
  src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



</body>
</html>
